/*
 * File:   Programa_principal.c
 * Author: Wels
 *
 * Created on 20 de marzo de 2020, 05:14 PM
 */


#include "xc.h"
#include "Configuracion.h"
#include <libpic30.h>

int16_t i;

const uint16_t Data[721]= {2298,2604,2113,2418,2724,2233,2538,2843,2351,2656,2960,2468,2772,3075,2582,2884,3187,2692,2994,3294,2799,3099,3398,2901,3199,3496,2997,3293,3589,3087,3381,3675,3171,3463,3754,3248,3538,3826,3318,3604,3890,3379,3663,3946,3432,3714,3994,3477,3755,4032,3513,3788,4062,3539,3811,4082,3556,3825,4093,3564,3830,4095,3563,3825,4087,3552,3811,4070,3531,3788,4043,3502,3755,4008,3463,3714,3963,3416,3663,3910,3360,3604,3848,3295,3538,3779,3223,3463,3702,3144,3381,3618,3058,3293,3528,2965,3199,3431,2867,3099,3329,2764,2994,3223,2656,2884,3113,2544,2772,2999,2429,2656,2882,2312,2538,2763,2193,2418,2644,2073,2298,2523,1953,2178,2403,1833,2058,2284,1714,1940,2167,1598,1825,2052,1484,1712,1940,1373,1603,1832,1267,1498,1729,1165,1398,1631,1069,1303,1538,978,1215,1452,894,1133,1373,817,1059,1301,748,992,1237,686,933,1181,633,883,1133,589,841,1094,553,808,1065,526,785,1045,509,771,1033,501,766,1032,503,771,1040,514,785,1057,534,808,1084,564,841,1119,602,883,1164,650,933,1217,706,992,1279,770,1059,1348,842,1133,1425,921,1215,1509,1008,1303,1599,1100,1398,1696,1198,1498,1797,1302,1603,1904,1410,1712,2014,1521,1825,2128,1636,1940,2245,1754,2058,2363,1873,2178,2483,1993,2298,2604,2113,2418,2724,2233,2538,2843,2351,2656,2960,2468,2772,3075,2582,2884,3187,2692,2994,3294,2799,3099,3398,2901,3199,3496,2997,3293,3589,3087,3381,3675,3171,3463,3754,3248,3538,3826,3318,3604,3890,3379,3663,3946,3432,3714,3994,3477,3755,4032,3513,3788,4062,3539,3811,4082,3556,3825,4093,3564,3830,4095,3563,3825,4087,3552,3811,4070,3531,3788,4043,3502,3755,4008,3463,3714,3963,3416,3663,3910,3360,3604,3848,3295,3538,3779,3223,3463,3702,3144,3381,3618,3058,3293,3528,2965,3199,3431,2867,3099,3329,2764,2994,3223,2656,2884,3113,2544,2772,2999,2429,2656,2882,2312,2538,2763,2193,2418,2644,2073,2298,2523,1953,2178,2403,1833,2058,2284,1714,1940,2167,1598,1825,2052,1484,1712,1940,1373,1603,1832,1267,1498,1729,1165,1398,1631,1069,1303,1538,978,1215,1452,894,1133,1373,817,1059,1301,748,992,1237,686,933,1181,633,883,1133,589,841,1094,553,808,1065,526,785,1045,509,771,1033,501,766,1032,503,771,1040,514,785,1057,534,808,1084,564,841,1119,602,883,1164,650,933,1217,706,992,1279,770,1059,1348,842,1133,1425,921,1215,1509,1008,1303,1599,1100,1398,1696,1198,1498,1797,1302,1603,1904,1410,1712,2014,1521,1825,2128,1636,1940,2245,1754,2058,2363,1873,2178,2483,1993,2298,2604,2113,2418,2724,2233,2538,2843,2351,2656,2960,2468,2772,3075,2582,2884,3187,2692,2994,3294,2799,3099,3398,2901,3199,3496,2997,3293,3589,3087,3381,3675,3171,3463,3754,3248,3538,3826,3318,3604,3890,3379,3663,3946,3432,3714,3994,3477,3755,4032,3513,3788,4062,3539,3811,4082,3556,3825,4093,3564,3830,4095,3563,3825,4087,3552,3811,4070,3531,3788,4043,3502,3755,4008,3463,3714,3963,3416,3663,3910,3360,3604,3848,3295,3538,3779,3223,3463,3702,3144,3381,3618,3058,3293,3528,2965,3199,3431,2867,3099,3329,2764,2994,3223,2656,2884,3113,2544,2772,2999,2429,2656,2882,2312,2538,2763,2193,2418,2644,2073,2298,2523,1953,2178,2403,1833,2058,2284,1714,1940,2167,1598,1825,2052,1484,1712,1940,1373,1603,1832,1267,1498,1729,1165,1398,1631,1069,1303,1538,978,1215,1452,894,1133,1373,817,1059,1301,748,992,1237,686,933,1181,633,883,1133,589,841,1094,553,808,1065,526,785,1045,509,771,1033,501,766,1032,503,771,1040,514,785,1057,534,808,1084,564,841,1119,602,883,1164,650,933,1217,706,992,1279,770,1059,1348,842,1133,1425,921,1215,1509,1008,1303,1599,1100,1398,1696,1198,1498,1797,1302,1603,1904,1410,1712,2014,1521,1825,2128,1636,1940,2245,1754,2058,2363,1873,2178,2483,1993,2298
};

#define C_b0 0.0115586129393856953
#define C_b1 0.0269127184226143519
#define C_b2 0.0689577752425093865
#define C_b3 0.124811024018249089
#define C_b4 0.172306936575946479
#define C_b5 0.190905865602590069
#define C_b6 0.172306936575946479
#define C_b7 0.124811024018249089
#define C_b8 0.0689577752425093865
#define C_b9 0.0269127184226143519
#define C_b10 0.0115586129393856953


typedef struct{
    uint16_t n[11];
    //uint16_t ADC;
}DataX_T;

typedef struct{
    float n[0];
}DataY_T;

DataX_T X;
DataY_T Y;
//Y = C_b x X

int main(void) {
    ADPCFG = 0x1FFF; //TODOS los pines Digitales
    TRISB = 0; //SALIDA
    LATB = 0;
    TRISF = 0; //SALIDA
    X.n[10] = 0;
    X.n[9] = 0;
    X.n[8] = 0;
    X.n[7] = 0;
    X.n[6] = 0;
    X.n[5] = 0;
    X.n[4] = 0;
    X.n[0] = 0;
    X.n[1] = 0;
    X.n[2] = 0;
    X.n[3] = 0;
    float tmp;
    while(1){
        for(i = 0; i<721; i++){
            X.n[10] = X.n[9];
            X.n[9] = X.n[8];
            X.n[8] = X.n[7];
            X.n[7] = X.n[6];
            X.n[6] = X.n[5];
            X.n[5] = X.n[4];
            X.n[4] = X.n[3];
            X.n[3] = X.n[2];
            X.n[2] = X.n[1];
            X.n[1] = X.n[0];
            X.n[0] = Data[i];
            tmp = C_b0*X.n[0] + C_b1*X.n[1] + C_b2*X.n[2] + C_b3*X.n[3]+ C_b4*X.n[4] + C_b5*X.n[5] + C_b6*X.n[6] + C_b7*X.n[7] + C_b8*X.n[8] + C_b9*X.n[9] + C_b10*X.n[10];
            Y.n[0] = tmp;
            LATF = (int16_t)Y.n[0]>>5;
            __delay_ms(1);
        }


    }
    
}
